<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <title>Porcelain Illumination</title>
    <style>
        * { box-sizing: border-box; margin: 0; padding: 0; }
        html,body { width: 100%; height: 100%; }
        body{
            background:#000;
            color:#fff;
            font-family: Inter, sans-serif;
            overflow:hidden;
        }
        #container{ position:fixed; width:100%; height:100%; }
        canvas{ display:block; }
        .ui-overlay{ position:fixed; top:0; left:0; width:100%; height:100%; pointer-events:none; z-index:100; }
        .loading-screen{ 
            position:fixed; inset:0; 
            display:flex; flex-direction:column; justify-content:center; align-items:center; 
            background:#000; z-index:1000; 
            font-size:18px;
        }
        .hud{ 
            position:fixed; top:20px; left:20px; 
            background:rgba(0,0,0,0.8); padding:12px 16px; border-radius:8px; 
            font-size:12px; pointer-events:auto; 
        }
        .controls{ 
            position:fixed; bottom:20px; left:20px; 
            background:rgba(0,0,0,0.8); padding:12px; border-radius:8px; 
            font-size:11px; pointer-events:auto;
        }
    </style>
</head>
<body>
    <div id="container"></div>

    <div class="loading-screen" id="loadingScreen">
        Loading Porcelain...
    </div>

    <div class="ui-overlay">
        <div class="hud">DRAG: ORBIT • SCROLL: ZOOM • SPACE: ROTATE</div>
        <div class="controls">
            SPACE: Auto-rotate • R: Reset camera • 1-4: Material presets
        </div>
    </div>

    <script type="module">
        import * as THREE from 'https://unpkg.com/three@0.165.0/build/three.module.js';
        import { OrbitControls } from 'https://unpkg.com/three@0.165.0/examples/jsm/controls/OrbitControls.js';
        import { GLTFLoader } from 'https://unpkg.com/three@0.165.0/examples/jsm/loaders/GLTFLoader.js';

        // Core setup
        const container = document.getElementById('container');
        const loadingScreen = document.getElementById('loadingScreen');
        
        const scene = new THREE.Scene();
        scene.background = new THREE.Color(0x050510);
        
        const camera = new THREE.PerspectiveCamera(45, window.innerWidth / window.innerHeight, 0.1, 100);
        camera.position.set(6, 4, 6);
        
        const renderer = new THREE.WebGLRenderer({ antialias: true });
        renderer.setSize(window.innerWidth, window.innerHeight);
        renderer.setPixelRatio(Math.min(window.devicePixelRatio, 2));
        renderer.outputColorSpace = THREE.SRGBColorSpace;
        renderer.toneMapping = THREE.ACESFilmicToneMapping;
        renderer.toneMappingExposure = 1.2;
        renderer.shadowMap.enabled = true;
        renderer.shadowMap.type = THREE.PCFSoftShadowMap;
        container.appendChild(renderer.domElement);

        // Controls
        const controls = new OrbitControls(camera, renderer.domElement);
        controls.enableDamping = true;
        controls.dampingFactor = 0.05;
        controls.minDistance = 2;
        controls.maxDistance = 20;

        // Professional 3-point lighting
        const ambientLight = new THREE.AmbientLight(0x404080, 0.6);
        scene.add(ambientLight);

        const keyLight = new THREE.DirectionalLight(0xffffff, 2.5);
        keyLight.position.set(10, 12, 8);
        keyLight.castShadow = true;
        keyLight.shadow.mapSize.width = 2048;
        keyLight.shadow.mapSize.height = 2048;
        scene.add(keyLight);

        const fillLight = new THREE.DirectionalLight(0x4a6cff, 1.2);
        fillLight.position.set(-8, 6, -6);
        scene.add(fillLight);

        const rimLight = new THREE.DirectionalLight(0xff9d6b, 0.8);
        rimLight.position.set(0, 8, -10);
        scene.add(rimLight);

        // Environment
        const ground = new THREE.Mesh(
            new THREE.CircleGeometry(10, 32),
            new THREE.MeshStandardMaterial({ 
                color: 0x111122,
                roughness: 0.8,
                metalness: 0.1
            })
        );
        ground.rotation.x = -Math.PI / 2;
        ground.receiveShadow = true;
        scene.add(ground);

        // Load model
        const loader = new GLTFLoader();
        let porcelain = null;
        let autoRotate = true;

        loader.load(
            './porcelain.glb',
            (gltf) => {
                porcelain = gltf.scene;
                
                // Setup porcelain materials and shadows
                porcelain.traverse((child) => {
                    if (child.isMesh) {
                        child.castShadow = true;
                        child.receiveShadow = true;
                        
                        if (child.material) {
                            // Professional porcelain material
                            child.material.roughness = 0.08;
                            child.material.metalness = 0.02;
                            child.material.envMapIntensity = 1.5;
                        }
                    }
                });

                // Center and scale
                const box = new THREE.Box3().setFromObject(porcelain);
                const center = box.getCenter(new THREE.Vector3());
                const size = box.getSize(new THREE.Vector3());
                
                porcelain.position.sub(center);
                porcelain.position.y += 1.5;
                
                const scale = 4 / Math.max(size.x, size.y, size.z);
                porcelain.scale.setScalar(scale);

                scene.add(porcelain);
                loadingScreen.style.display = 'none';
                
                // Set camera target
                controls.target.copy(porcelain.position);
            },
            (progress) => {
                if (progress.lengthComputable) {
                    const percent = Math.round((progress.loaded / progress.total) * 100);
                    loadingScreen.textContent = `Loading: ${percent}%`;
                }
            },
            (error) => {
                console.error('Load error:', error);
                loadingScreen.textContent = 'Error loading porcelain.glb';
                loadingScreen.style.color = '#ff4444';
            }
        );

        // Simple particles for atmosphere
        const particleGeometry = new THREE.BufferGeometry();
        const particleCount = 800;
        const posArray = new Float32Array(particleCount * 3);
        
        for(let i = 0; i < particleCount * 3; i++) {
            posArray[i] = (Math.random() - 0.5) * 15;
        }
        
        particleGeometry.setAttribute('position', new THREE.BufferAttribute(posArray, 3));
        const particleMaterial = new THREE.PointsMaterial({
            size: 0.08,
            color: 0x4488ff,
            transparent: true,
            opacity: 0.6,
            blending: THREE.AdditiveBlending
        });
        const particles = new THREE.Points(particleGeometry, particleMaterial);
        scene.add(particles);

        // Animation
        function animate() {
            requestAnimationFrame(animate);
            
            // Auto-rotation
            if (porcelain && autoRotate) {
                porcelain.rotation.y += 0.008;
            }
            
            // Subtle particle movement
            particles.rotation.y += 0.002;
            
            controls.update();
            renderer.render(scene, camera);
        }
        animate();

        // Controls
        document.addEventListener('keydown', (e) => {
            switch(e.code) {
                case 'Space':
                    e.preventDefault();
                    autoRotate = !autoRotate;
                    break;
                case 'KeyR':
                    controls.reset();
                    break;
                case 'Digit1':
                    setMaterialPreset('porcelain');
                    break;
                case 'Digit2':
                    setMaterialPreset('ceramic');
                    break;
                case 'Digit3':
                    setMaterialPreset('glossy');
                    break;
                case 'Digit4':
                    setMaterialPreset('matte');
                    break;
            }
        });

        function setMaterialPreset(preset) {
            if (!porcelain) return;
            
            porcelain.traverse((child) => {
                if (child.isMesh && child.material) {
                    switch(preset) {
                        case 'porcelain':
                            child.material.roughness = 0.08;
                            child.material.metalness = 0.02;
                            break;
                        case 'ceramic':
                            child.material.roughness = 0.3;
                            child.material.metalness = 0.0;
                            break;
                        case 'glossy':
                            child.material.roughness = 0.02;
                            child.material.metalness = 0.1;
                            break;
                        case 'matte':
                            child.material.roughness = 0.8;
                            child.material.metalness = 0.0;
                            break;
                    }
                }
            });
        }

        window.addEventListener('resize', () => {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        });
    </script>
</body>
</html>
